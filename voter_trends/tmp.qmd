---
title: Partisan Identification Trends
---


## Overall Trend

```{r}
library(tidyverse)
library(ggpubr)
library(plotly)
library(gt)
options(digits=3)

anes_df <- read_csv(here::here("data", "anes_timeseries_cdf_csv_20220916.csv"))

pal <- colorRampPalette(c("orangered3", "gray","darkblue"))


p <- anes_df |> 
    filter(VCF0301 %in% 1:7) |> 
    #filter(VCF0127b %in% c(1, 3) & VCF0301 > 0) |>
    group_by(VCF0004, VCF0301) |>  
    summarize(n=sum(VCF0009z)) |> 
    group_by(VCF0004) |>
    mutate(total=sum(n), 
        Percentage=n/total*100, 
        Party=factor(VCF0301, 1:7, 
        labels=c("Strong Dem", "Weak Dem", "Lean Dem", "Indep", "Lean Rep", "Weak Rep", "Strong Rep"))) |> 
    rename("Year"="VCF0004") |>
    ggplot(aes(x=Year, y=Percentage, 
    fill=Party)) + 
    geom_col() + 
    geom_hline(yintercept=5, linetype="dashed", color="grey70") + 
    geom_hline(yintercept=c(25, 75), linetype="dotted", color="grey70") + 
    scale_fill_manual("Party ID", values=rev(pal(7))) + 
    labs(y="Percentage", x="") + 
    theme_pubr() +
    theme(legend.position="bottom")

ggplotly(p) |> 
    layout(legend = list(
        orientation = "h"
        )
    )


```


## By Education


```{r}

levels <- 1:4
variable <- "VCF0110"
var_levels <- c("Less than High School", "High School Degree", 
        "Some College", "College Degree")
var_name <- "Education"
p <- list()

p_data <- anes_df |> 
    filter(VCF0301 %in% 1:7) |> 
    rename(var=!!variable) |>
    group_by(VCF0004, VCF0301,var) |>  
    summarize(n=sum(VCF0009z)) |> 
    group_by(VCF0004, var) |>
    mutate(total=sum(n), 
        Percentage=(n/total)*100, 
        Party=factor(VCF0301, 1:7, 
        labels=c("Strong Dem", "Weak Dem", "Lean Dem", "Indep", "Lean Rep", "Weak Rep", "Strong Rep"))) |>
        rename("Year"="VCF0004")

for(ii in seq_along(levels)){
    p[[ii]] <- p_data |> filter(var==ii) |>
        ggplot(aes(x=Year, y=Percentage, 
        fill=Party)) + 
        geom_col() + 
        geom_hline(yintercept=50, linetype="dashed", color="grey70") + 
        geom_hline(yintercept=c(25,75), linetype="dotted",  color="grey70") + 
        scale_fill_manual("Party ID", values=rev(pal(7))) + 
        # scale_y_continuous(labels=scales::label_percent()) +
        labs(y="Percentage", x="") + 
        theme_pubr() 

}

```

::: {.panel-tabset group="education"}

### Less Than High School 
```{r}

ggplotly(p[[1]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```


### High School Degree
```{r}
ggplotly(p[[2]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```

### Some College

```{r}
ggplotly(p[[3]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```

### College Degree

```{r}
ggplotly(p[[4]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```

### Raw Data

```{r}

data_out <- p_data |> ungroup() |>
    select(Year, var, Party, Percentage, total) |> 
    mutate(var=factor(var, levels, 
        labels=var_levels)) |> 
    rename(N=total) |> drop_na(var) |> 
    arrange(Year, var, Party) |> 
    rename(!!var_name:=var) 

data_out |> 
    gt() |> fmt_integer(columns=N) |> 
    fmt_number(columns=Percentage) |>
    opt_interactive(use_filters=TRUE, use_compact_mode=TRUE)

write_csv(file=here::here("voter_trends", "data", paste0("party_",var_name, ".csv")), data_out)

```

[CSV](data/party_Education.csv)

:::


## By Gender


```{r}

levels <- 1:2
variable <- "VCF0104"
var_levels <- c("Male", "Female")
var_name <- "Gender"
p <- list()

p_data <- anes_df |> 
    filter(VCF0301 %in% 1:7) |> 
    rename(var=!!variable) |>
    group_by(VCF0004, VCF0301,var) |>  
    summarize(n=sum(VCF0009z)) |> 
    group_by(VCF0004, var) |>
    mutate(total=sum(n), 
        Percentage=(n/total)*100, 
        Party=factor(VCF0301, 1:7, 
        labels=c("Strong Dem", "Weak Dem", "Lean Dem", "Indep", "Lean Rep", "Weak Rep", "Strong Rep"))) |>
        rename("Year"="VCF0004")

for(ii in seq_along(levels)){
    p[[ii]] <- p_data |> filter(var==ii) |>
        ggplot(aes(x=Year, y=Percentage, 
        fill=Party)) + 
        geom_col() + 
        geom_hline(yintercept=50, linetype="dashed", color="grey70") + 
        geom_hline(yintercept=c(25,75), linetype="dotted",  color="grey70") + 
        scale_fill_manual("Party ID", values=rev(pal(7))) + 
        # scale_y_continuous(labels=scales::label_percent()) +
        labs(y="Percentage", x="") + 
        theme_pubr() 

}

```

::: {.panel-tabset group="gender"}

### Male 
```{r}

ggplotly(p[[1]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```


### Female
```{r}
ggplotly(p[[2]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```

### Raw Data

```{r}

data_out <- p_data |> ungroup() |>
    select(Year, var, Party, Percentage, total) |> 
    mutate(var=factor(var, levels, 
        labels=var_levels)) |> 
    rename(N=total) |> drop_na(var) |> 
    arrange(Year, var, Party) |> 
    rename(!!var_name:=var) 

data_out |> 
    gt() |> fmt_integer(columns=N) |> 
    fmt_number(columns=Percentage) |>
    opt_interactive(use_filters=TRUE, use_compact_mode=TRUE)

write_csv(file=here::here("voter_trends", "data", paste0("party_",var_name, ".csv")), data_out)

```

[CSV](data/party_Gender.csv)

:::



## By Income


```{r}

levels <- 1:5
variable <- "VCF0114"
var_levels <- c("0-16 Percentile", "17-33 Percentile",
                "34-67 Percentile", "68-95 Percentile",
                "96-100 Percentile")
var_name <- "Gender"
p <- list()

p_data <- anes_df |> 
    filter(VCF0301 %in% 1:7) |> 
    rename(var=!!variable) |>
    group_by(VCF0004, VCF0301,var) |>  
    summarize(n=sum(VCF0009z)) |> 
    group_by(VCF0004, var) |>
    mutate(total=sum(n), 
        Percentage=(n/total)*100, 
        Party=factor(VCF0301, 1:7, 
        labels=c("Strong Dem", "Weak Dem", "Lean Dem", "Indep", "Lean Rep", "Weak Rep", "Strong Rep"))) |>
        rename("Year"="VCF0004")

for(ii in seq_along(levels)){
    p[[ii]] <- p_data |> filter(var==ii) |>
        ggplot(aes(x=Year, y=Percentage, 
        fill=Party)) + 
        geom_col() + 
        geom_hline(yintercept=50, linetype="dashed", color="grey70") + 
        geom_hline(yintercept=c(25,75), linetype="dotted",  color="grey70") + 
        scale_fill_manual("Party ID", values=rev(pal(7))) + 
        # scale_y_continuous(labels=scales::label_percent()) +
        labs(y="Percentage", x="") + 
        theme_pubr() 

}

```

::: {.panel-tabset group="income"}

### 0-16 Percentile
```{r}

ggplotly(p[[1]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```


### 17-33 Percentile
```{r}
ggplotly(p[[2]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```

### 14-67 Percentile
```{r}
ggplotly(p[[3]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```

### 67-95 Percentile
```{r}
ggplotly(p[[4]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```


### 96-100 Percentile
```{r}
ggplotly(p[[5]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```


### Raw Data

```{r}

data_out <- p_data |> ungroup() |>
    select(Year, var, Party, Percentage, total) |> 
    mutate(var=factor(var, levels, 
        labels=var_levels)) |> 
    rename(N=total) |> drop_na(var) |> 
    arrange(Year, var, Party) |> 
    rename(!!var_name:=var) 

data_out |> 
    gt() |> fmt_integer(columns=N) |> 
    fmt_number(columns=Percentage) |>
    opt_interactive(use_filters=TRUE, use_compact_mode=TRUE)

write_csv(file=here::here("voter_trends", "data", paste0("party_",var_name, ".csv")), data_out)

```

[CSV](data/party_Income.csv)

:::



## By Race

Note: Options for race have varied significantly overtime, and the size of the ANES means that there are very small samples Asian and American Indian. Because of this they are grouped together into "Other, non-Hispanic" which also includes those who identify as mutliple racial categories. I also drop any years where there are fewer than 50 individuals in the sample. This is far from ideal. 

```{r}

levels <- 1:4
variable <- "VCF0105b"
var_levels <- c("White, non-Hispanic", "Black, non-Hispanic", 
        "Hispanic", "Other, non-Hispanic")
var_name <- "Race"
p <- list()

p_data <- anes_df |> 
    filter(VCF0301 %in% 1:7) |> 
    rename(var=!!variable) |>
    group_by(VCF0004, VCF0301,var) |>  
    summarize(n=sum(VCF0009z)) |> 
    group_by(VCF0004, var) |>
    mutate(total=sum(n), 
        Percentage=(n/total)*100, 
        Party=factor(VCF0301, 1:7, 
        labels=c("Strong Dem", "Weak Dem", "Lean Dem", "Indep", "Lean Rep", "Weak Rep", "Strong Rep"))) |>
        rename("Year"="VCF0004") |> 
    filter(total > 50) 

for(ii in seq_along(levels)){
    p[[ii]] <- p_data |> filter(var==ii) |>
        ggplot(aes(x=Year, y=Percentage, 
        fill=Party)) + 
        geom_col() + 
        geom_hline(yintercept=50, linetype="dashed", color="grey70") + 
        geom_hline(yintercept=c(25,75), linetype="dotted",  color="grey70") + 
        scale_fill_manual("Party ID", values=rev(pal(7))) + 
        # scale_y_continuous(labels=scales::label_percent()) +
        labs(y="Percentage", x="") + 
        theme_pubr() 

}

```

::: {.panel-tabset group="race"}

### White, non-Hispanic
```{r}

ggplotly(p[[1]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```


### Black, non-Hispanic
```{r}
ggplotly(p[[2]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```

### Hispanic

```{r}
ggplotly(p[[3]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```

### Other, non-Hispanic

```{r}
ggplotly(p[[4]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```



### Raw Data

```{r}

data_out <- p_data |> ungroup() |>
    select(Year, var, Party, Percentage, total) |> 
    mutate(var=factor(var, levels, 
        labels=var_levels)) |> 
    rename(N=total) |> drop_na(var) |> 
    arrange(Year, var, Party) |> 
    rename(!!var_name:=var) 

data_out |> 
    gt() |> fmt_integer(columns=N) |> 
    fmt_number(columns=Percentage) |>
    opt_interactive(use_filters=TRUE, use_compact_mode=TRUE)

write_csv(file=here::here("voter_trends", "data", paste0("party_",var_name, ".csv")), data_out)

```

[CSV](data/party_Race.csv)

:::



## By Subjective Class




```{r}


levels <- 1:2
variable <- "VCF0148a"
var_levels <- c("Working Class", "Middle Class")
var_name <- "Class"
p <- list()

p_data <- anes_df |> 
    mutate(VCF0148a = 
        case_match(VCF0148a, 
            1:3 ~ 1, 
            4:6 ~ 2, 
            .default=NA)) |> 
    filter(VCF0301 %in% 1:7) |> 
    rename(var=!!variable) |>
    group_by(VCF0004, VCF0301,var) |>  
    summarize(n=sum(VCF0009z)) |> 
    group_by(VCF0004, var) |>
    mutate(total=sum(n), 
        Percentage=(n/total)*100, 
        Party=factor(VCF0301, 1:7, 
        labels=c("Strong Dem", "Weak Dem", "Lean Dem", "Indep", "Lean Rep", "Weak Rep", "Strong Rep"))) |>
        rename("Year"="VCF0004")

for(ii in seq_along(levels)){
    p[[ii]] <- p_data |> filter(var==ii) |>
        ggplot(aes(x=Year, y=Percentage, 
        fill=Party)) + 
        geom_col() + 
        geom_hline(yintercept=50, linetype="dashed", color="grey70") + 
        geom_hline(yintercept=c(25,75), linetype="dotted",  color="grey70") + 
        scale_fill_manual("Party ID", values=rev(pal(7))) + 
        # scale_y_continuous(labels=scales::label_percent()) +
        labs(y="Percentage", x="") + 
        theme_pubr() 

}

```

::: {.panel-tabset group="class"}

### Working Class
```{r}

ggplotly(p[[1]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```


### Middle Class
```{r}
ggplotly(p[[2]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```


### Raw Data

```{r}

data_out <- p_data |> ungroup() |>
    select(Year, var, Party, Percentage, total) |> 
    mutate(var=factor(var, levels, 
        labels=var_levels)) |> 
    rename(N=total) |> drop_na(var) |> 
    arrange(Year, var, Party) |> 
    rename(!!var_name:=var) 

data_out |> 
    gt() |> fmt_integer(columns=N) |> 
    fmt_number(columns=Percentage) |>
    opt_interactive(use_filters=TRUE, use_compact_mode=TRUE)

write_csv(file=here::here("voter_trends", "data", paste0("party_",var_name, ".csv")), data_out)

```

[CSV](data/party_Class.csv)

:::





## By Union Status




```{r}


levels <- 1:2
variable <- "VCF0127"
var_levels <- c("Union Household", "Non-Union")
var_name <- "Class"
p <- list()

p_data <- anes_df |> 
    filter(VCF0301 %in% 1:7) |> 
    rename(var=!!variable) |>
    group_by(VCF0004, VCF0301,var) |>  
    summarize(n=sum(VCF0009z)) |> 
    group_by(VCF0004, var) |>
    mutate(total=sum(n), 
        Percentage=(n/total)*100, 
        Party=factor(VCF0301, 1:7, 
        labels=c("Strong Dem", "Weak Dem", "Lean Dem", "Indep", "Lean Rep", "Weak Rep", "Strong Rep"))) |>
        rename("Year"="VCF0004")

for(ii in seq_along(levels)){
    p[[ii]] <- p_data |> filter(var==ii) |>
        ggplot(aes(x=Year, y=Percentage, 
        fill=Party)) + 
        geom_col() + 
        geom_hline(yintercept=50, linetype="dashed", color="grey70") + 
        geom_hline(yintercept=c(25,75), linetype="dotted",  color="grey70") + 
        scale_fill_manual("Party ID", values=rev(pal(7))) + 
        # scale_y_continuous(labels=scales::label_percent()) +
        labs(y="Percentage", x="") + 
        theme_pubr() 

}

```

::: {.panel-tabset group="union"}

### Union Household
```{r}

ggplotly(p[[1]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```


### Non-Union
```{r}
ggplotly(p[[2]]) |> 
    layout(legend = list(
        orientation = "h"
        )
    )

```


### Raw Data

```{r}

data_out <- p_data |> ungroup() |>
    select(Year, var, Party, Percentage, total) |> 
    mutate(var=factor(var, levels, 
        labels=var_levels)) |> 
    rename(N=total) |> drop_na(var) |> 
    arrange(Year, var, Party) |> 
    rename(!!var_name:=var) 

data_out |> 
    gt() |> fmt_integer(columns=N) |> 
    fmt_number(columns=Percentage) |>
    opt_interactive(use_filters=TRUE, use_compact_mode=TRUE)

write_csv(file=here::here("voter_trends", "data", paste0("party_",var_name, ".csv")), data_out)

```

[CSV](data/party_Class.csv)

:::


## Data Notes

All data presented here is from the [American National Election Studies survey](https://electionstudies.org/) using the `VCF0009z` weights. 
